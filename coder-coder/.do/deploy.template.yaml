spec:
  name: deploystack
  region: nyc
  services:
    - name: coder
      image:
        registry_type: DOCKER_HUB
        repository: coder/coder
        tag: ${CODER_VERSION
      http_port: 7080
      instance_count: 1
      instance_size_slug: basic-xxs
      run_command: ""
      envs:
        - key: postgresql://${POSTGRES_USER:-username}:${POSTGRES_PASSWORD:-password}@database/${POSTGRES_DB:-coder}?sslmode
          value: disable
        - key: CODER_HTTP_ADDRESS
          value: 0.0.0.0:7080
        - key: CODER_ACCESS_URL
          value: ${CODER_ACCESS_URL}
      routes:
        - path: /
    - name: database
      image:
        registry_type: DOCKER_HUB
        repository: postgres
        tag: "16"
      http_port: 5432
      instance_count: 1
      instance_size_slug: basic-xxs
      run_command: ""
      envs:
        - key: POSTGRES_USER
          value: ${POSTGRES_USER:-username}
        - key: POSTGRES_PASSWORD
          value: ${POSTGRES_PASSWORD:-password}
        - key: POSTGRES_DB
          value: ${POSTGRES_DB:-coder}
      routes:
        - path: /database
